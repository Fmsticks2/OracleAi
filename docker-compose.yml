version: "3.9"
services:
  backend:
    build:
      context: ./backend
    environment:
      PORT: 3000
      NODE_ENV: production
      LOG_LEVEL: info
      RPC_URL: ${RPC_URL}
      REGISTRY_ADDRESS: ${REGISTRY_ADDRESS}
      PRIVATE_KEY: ${PRIVATE_KEY}
      API_KEY: ${API_KEY}
      CORS_ORIGIN: http://localhost:8080
      RATE_LIMIT_MAX: ${RATE_LIMIT_MAX:-200}
      PINATA_API_KEY: ${PINATA_API_KEY}
      PINATA_SECRET_KEY: ${PINATA_SECRET_KEY}
      USE_REDIS_QUEUE: ${USE_REDIS_QUEUE:-true}
      USE_REDIS_NONCE: ${USE_REDIS_NONCE:-true}
      QUEUE_WORKER: ${QUEUE_WORKER:-1}
      REDIS_URL: redis://redis:6379
    ports:
      - "3000:3000"
    restart: unless-stopped

  dashboard:
    build:
      context: ./dashboard
      args:
        VITE_API_BASE_URL: http://localhost:3000/api/v1
    ports:
      - "8080:80"
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    restart: unless-stopped